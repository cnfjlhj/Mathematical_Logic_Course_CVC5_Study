# SMT åŸºç¡€ï¼šä» SAT åˆ° SMT

## ä»€ä¹ˆæ˜¯å¯æ»¡è¶³æ€§é—®é¢˜ï¼Ÿ

### SATï¼šå¸ƒå°”å¯æ»¡è¶³æ€§

**SATï¼ˆBoolean Satisfiabilityï¼‰** æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ç»å…¸é—®é¢˜ï¼š

> ç»™å®šä¸€ä¸ªå¸ƒå°”å…¬å¼ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ç»„å˜é‡èµ‹å€¼ä½¿å¾—å…¬å¼ä¸ºçœŸï¼Ÿ

**ç¤ºä¾‹**ï¼š
```
å…¬å¼ï¼š(a âˆ¨ b) âˆ§ (Â¬a âˆ¨ c) âˆ§ (Â¬b âˆ¨ Â¬c)
æ±‚è§£ï¼šæ˜¯å¦å­˜åœ¨ a, b, c çš„èµ‹å€¼ä½¿å…¬å¼ä¸ºçœŸï¼Ÿ
```

**ç­”æ¡ˆ**ï¼šæ˜¯çš„ï¼Œä¾‹å¦‚ `a=True, b=False, c=True`ã€‚

### SAT çš„å±€é™æ€§

SAT åªèƒ½å¤„ç†**å¸ƒå°”å˜é‡**å’Œ**é€»è¾‘è¿ç®—**ï¼Œæ— æ³•ç›´æ¥è¡¨è¾¾ï¼š
- ç®—æœ¯çº¦æŸï¼š`x + y > 10`
- æ•°ç»„æ“ä½œï¼š`arr[i] != arr[j]`
- å­—ç¬¦ä¸²å…³ç³»ï¼š`s1 + s2 = "hello"`

---

## SMTï¼šå¯æ»¡è¶³æ€§æ¨¡ç†è®º

**SMTï¼ˆSatisfiability Modulo Theoriesï¼‰** æ˜¯ SAT çš„æ‰©å±•ï¼š

> åœ¨ç‰¹å®šç†è®ºï¼ˆå¦‚ç®—æœ¯ã€æ•°ç»„ï¼‰çš„çº¦æŸä¸‹ï¼Œåˆ¤æ–­é€»è¾‘å…¬å¼çš„å¯æ»¡è¶³æ€§ã€‚

### SMT = SAT + Theories

```
SAT:  (a âˆ¨ b) âˆ§ (Â¬a âˆ¨ c)
      â†“ æ‰©å±•
SMT:  (x > 0) âˆ§ (y > 0) âˆ§ (x + y = 10)
      â””â”€ ç†è®ºï¼šçº¿æ€§æ•´æ•°ç®—æœ¯ï¼ˆLIAï¼‰
```

---

## å¸¸è§çš„ SMT ç†è®º

### 1. **QF_LIA**ï¼šæ— é‡è¯çº¿æ€§æ•´æ•°ç®—æœ¯

- å˜é‡ï¼šæ•´æ•°
- æ“ä½œï¼š`+`, `-`, `*`ï¼ˆå¸¸æ•°ä¹˜æ³•ï¼‰, `<`, `<=`, `=`
- ç¤ºä¾‹ï¼š`3x + 2y >= 5`

### 2. **QF_LRA**ï¼šæ— é‡è¯çº¿æ€§å®æ•°ç®—æœ¯

- å˜é‡ï¼šå®æ•°
- æ“ä½œï¼šåŒ LIAï¼Œä½†æ”¯æŒå®æ•°é™¤æ³•
- ç¤ºä¾‹ï¼š`x + 0.5y = 3.14`

### 3. **QF_NIA**ï¼šæ— é‡è¯éçº¿æ€§æ•´æ•°ç®—æœ¯

- å…è®¸å˜é‡ç›¸ä¹˜
- ç¤ºä¾‹ï¼š`x * y > 10`, `x^2 + y^2 = 25`

### 4. **QF_BV**ï¼šä½å‘é‡ç†è®º

- å›ºå®šå®½åº¦çš„äºŒè¿›åˆ¶æ•°
- æ“ä½œï¼šä½è¿ç®—ï¼ˆ`&`, `|`, `^`ï¼‰ã€ç§»ä½ã€ç®—æœ¯
- åº”ç”¨ï¼šç¡¬ä»¶éªŒè¯ã€å¯†ç å­¦

### 5. **Arrays**ï¼šæ•°ç»„ç†è®º

- æ“ä½œï¼š`select(arr, i)`, `store(arr, i, val)`
- çº¦æŸï¼š`select(store(arr, i, v), i) = v`

### 6. **Strings**ï¼šå­—ç¬¦ä¸²ç†è®º

- æ“ä½œï¼šæ‹¼æ¥ã€é•¿åº¦ã€å­ä¸²ã€æ­£åˆ™åŒ¹é…
- åº”ç”¨ï¼šWeb å®‰å…¨ã€è¾“å…¥éªŒè¯

### 7. **Quantifiers**ï¼šé‡è¯

- `âˆ€x. P(x)`ï¼ˆå…¨ç§°é‡è¯ï¼‰
- `âˆƒx. P(x)`ï¼ˆå­˜åœ¨é‡è¯ï¼‰
- æå¤§å¢åŠ æ±‚è§£å¤æ‚åº¦

---

## SMT æ±‚è§£å™¨çš„å·¥ä½œåŸç†

### DPLL(T) æ¶æ„

ç°ä»£ SMT æ±‚è§£å™¨ï¼ˆåŒ…æ‹¬ cvc5ï¼‰é‡‡ç”¨ **DPLL(T)** æ¡†æ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAT Solver (DPLL/CDCL)             â”‚
â”‚  å¤„ç†å¸ƒå°”ç»“æ„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ çŒœæµ‹å¸ƒå°”èµ‹å€¼
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Theory Solvers                     â”‚
â”‚  â”œâ”€ ç®—æœ¯æ±‚è§£å™¨                       â”‚
â”‚  â”œâ”€ æ•°ç»„æ±‚è§£å™¨                       â”‚
â”‚  â””â”€ ...                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ åé¦ˆå†²çªå­å¥
           â†“
      å­¦ä¹ å¹¶å›æº¯
```

**å…³é”®æ­¥éª¤**ï¼š
1. **SAT å±‚**ï¼šçŒœæµ‹ä¸€ç»„å¸ƒå°”èµ‹å€¼
2. **Theory å±‚**ï¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³ç†è®ºçº¦æŸ
3. **å†²çªåˆ†æ**ï¼šå¦‚æœä¸æ»¡è¶³ï¼Œç”Ÿæˆå†²çªå­å¥
4. **å­¦ä¹ **ï¼šSAT å±‚å­¦ä¹ æ–°å­å¥ï¼Œé¿å…é‡å¤é”™è¯¯

---

## cvc5 ä¸­çš„ç†è®º

cvc5 æ”¯æŒçš„ä¸»è¦ç†è®ºï¼š

| ç†è®º | ç¼©å†™ | Python ç¤ºä¾‹ |
|------|------|------------|
| å¸ƒå°”é€»è¾‘ | BOOL | `And(a, Or(b, Not(c)))` |
| æ•´æ•°ç®—æœ¯ | LIA/NIA | `x + y > 10` |
| å®æ•°ç®—æœ¯ | LRA/NRA | `x * 0.5 + y == 3.14` |
| ä½å‘é‡ | BV | `BitVec('x', 8) & 0xFF` |
| æ•°ç»„ | Arrays | `Select(arr, i) == 5` |
| å­—ç¬¦ä¸² | Strings | `Concat(s1, s2) == "hello"` |
| æ•°æ®ç±»å‹ | DT | `Cons(1, Nil)` |

---

## SMT-LIB è¯­è¨€

**SMT-LIB** æ˜¯ SMT æ±‚è§£å™¨çš„æ ‡å‡†è¾“å…¥è¯­è¨€ã€‚

### ç¤ºä¾‹ï¼šçº¿æ€§æ•´æ•°ç®—æœ¯

```smt2
(set-logic QF_LIA)
(declare-const x Int)
(declare-const y Int)
(assert (> x 0))
(assert (> y 0))
(assert (= (+ x y) 10))
(check-sat)
(get-model)
```

**cvc5 Python API ç­‰ä»·ä»£ç **ï¼š
```python
from cvc5.pythonic import *
x, y = Ints('x y')
solve(x > 0, y > 0, x + y == 10)
```

---

## SAT vs SMT å¯¹æ¯”

| ç‰¹æ€§ | SAT | SMT |
|------|-----|-----|
| å˜é‡ç±»å‹ | ä»…å¸ƒå°” | å¸ƒå°” + æ•´æ•°/å®æ•°/ä½å‘é‡ç­‰ |
| çº¦æŸè¡¨è¾¾ | é€»è¾‘è¿ç®— | é€»è¾‘ + ç®—æœ¯ + å…¶ä»–ç†è®º |
| æ±‚è§£å¤æ‚åº¦ | NP-å®Œå…¨ | NP-å®Œå…¨ï¼ˆæŸäº›ç†è®ºå¯åˆ¤å®šï¼‰ |
| å…¸å‹åº”ç”¨ | ç»„åˆä¼˜åŒ–ã€ç”µè·¯éªŒè¯ | ç¨‹åºéªŒè¯ã€ç¬¦å·æ‰§è¡Œ |
| å·¥å…·ç¤ºä¾‹ | MiniSat, Glucose | cvc5, Z3, Yices |

---

## ä½•æ—¶ä½¿ç”¨ SMT æ±‚è§£å™¨ï¼Ÿ

### âœ… é€‚ç”¨åœºæ™¯

1. **å½¢å¼åŒ–éªŒè¯**ï¼šè¯æ˜ç¨‹åº/ç¡¬ä»¶æ­£ç¡®æ€§
2. **ç¬¦å·æ‰§è¡Œ**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
3. **çº¦æŸæ±‚è§£**ï¼šæ•°ç‹¬ã€è°ƒåº¦é—®é¢˜ç­‰
4. **å®šç†è¯æ˜**ï¼šæ•°å­¦å‘½é¢˜éªŒè¯

### âŒ ä¸é€‚ç”¨åœºæ™¯

1. **çº¯å¸ƒå°”å…¬å¼**ï¼šç”¨ SAT æ±‚è§£å™¨æ›´å¿«
2. **ä¼˜åŒ–é—®é¢˜**ï¼šéœ€è¦æ‰¾"æœ€ä¼˜è§£"ï¼ˆç”¨ LP/ILP/CPï¼‰
3. **å¤§è§„æ¨¡é‡è¯**ï¼šSMT æ±‚è§£å™¨æ•ˆç‡è¾ƒä½

---

## ç†è®ºç»„åˆ

cvc5 çš„å¼ºå¤§ä¹‹å¤„åœ¨äºèƒ½å¤Ÿ**ç»„åˆå¤šä¸ªç†è®º**ï¼š

```python
from cvc5.pythonic import *

# ç»„åˆï¼šæ•´æ•°ç®—æœ¯ + æ•°ç»„ + å­—ç¬¦ä¸²
arr = Array('arr', IntSort(), StringSort())
i = Int('i')
s = String('s')

solve(
    i >= 0,
    i < 10,
    Select(arr, i) == s,
    Length(s) > 3
)
```

---

## ä¸‹ä¸€æ­¥

- ğŸ‘‰ [å­¦ä¹  cvc5 æ¶æ„åŸç†](03_cvc5_architecture.md)
- ğŸ‘‰ [æŸ¥çœ‹å®é™…ä»£ç ç¤ºä¾‹](../examples/basics/)

---

## å‚è€ƒæ–‡çŒ®

1. Barrett, C., et al. "Satisfiability Modulo Theories." Handbook of Satisfiability (2009).
2. De Moura, L., BjÃ¸rner, N. "Satisfiability Modulo Theories: Introduction and Applications." CACM (2011).
3. [SMT-LIB å®˜æ–¹æ ‡å‡†](http://smtlib.cs.uiowa.edu/)
